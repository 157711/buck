PLATFORM_SRCS = [
    "AbstractCxxPlatform.java",
    "AbstractHeaderVerification.java",
    "AbstractNativeLinkableInput.java",
    "AbstractNativeLinkTargetMode.java",
    "AbstractPreprocessor.java",
    "Archiver.java",
    "BsdArchiver.java",
    "CanProvideNativeLinkTarget.java",
    "ClangCompiler.java",
    "ClangPreprocessor.java",
    "Compiler.java",
    "CompilerProvider.java",
    "CxxGenrule.java",
    "CxxLocationMacroExpander.java",
    "CxxToolProvider.java",
    "DebugPathSanitizer.java",
    "DebugSection.java",
    "DebugSectionFinder.java",
    "DebugSectionProperty.java",
    "DefaultCompiler.java",
    "GccCompiler.java",
    "GccPreprocessor.java",
    "GnuArchiver.java",
    "GnuLinker.java",
    "LazyDelegatingArchiver.java",
    "LazyDelegatingSymbolNameTool.java",
    "Linker.java",
    "LinkerProvider.java",
    "Linkers.java",
    "NativeLinkable.java",
    "NativeLinkables.java",
    "NativeLinkStrategy.java",
    "NativeLinkTarget.java",
    "ObjectFileCommonModificationDate.java",
    "ObjectFileScrubbers.java",
    "PosixNmSymbolNameTool.java",
    "Preprocessor.java",
    "PreprocessorProvider.java",
    "SharedLibraryInterfaceFactory.java",
    "SymbolNameTool.java",
    "WindowsArchiver.java",
    "WindowsCompiler.java",
    "WindowsLinker.java",
    "WindowsPreprocessor.java",
]

java_immutables_library(
    name = "platform",
    srcs = PLATFORM_SRCS,
    immutable_types = [
        "CxxPlatform",
        "NativeLinkableInput",
        "NativeLinkTargetMode",
    ],
    visibility = [
        "PUBLIC",
    ],
    deps = [
        "//src/com/facebook/buck/android:utils",
        "//src/com/facebook/buck/apple/xcode:xcode",
        "//src/com/facebook/buck/artifact_cache:artifact_cache",
        "//src/com/facebook/buck/cli:config",
        "//src/com/facebook/buck/config:config",
        "//src/com/facebook/buck/cxx/elf:elf",
        "//src/com/facebook/buck/event:event",
        "//src/com/facebook/buck/event:interfaces",
        "//src/com/facebook/buck/event/external:external_lib",
        "//src/com/facebook/buck/graph:graph",
        "//src/com/facebook/buck/hashing:hashing",
        "//src/com/facebook/buck/io:BuckPaths",
        "//src/com/facebook/buck/io:ProjectFilesystemDelegate",
        "//src/com/facebook/buck/io:executable-finder",
        "//src/com/facebook/buck/io:io",
        "//src/com/facebook/buck/io:transport",
        "//src/com/facebook/buck/jvm/core:classhash",
        "//src/com/facebook/buck/jvm/core:packagefinder",
        "//src/com/facebook/buck/jvm/java:javac-sink",
        "//src/com/facebook/buck/jvm/java/abi/source/api:api",
        "//src/com/facebook/buck/log:api",
        "//src/com/facebook/buck/message_ipc:message_ipc",
        "//src/com/facebook/buck/model:build_id",
        "//src/com/facebook/buck/model:macros",
        "//src/com/facebook/buck/model:model",
        "//src/com/facebook/buck/model:simple_types",
        "//src/com/facebook/buck/parser:rule_pattern",
        "//src/com/facebook/buck/python:support",
        "//src/com/facebook/buck/query:query",
        "//src/com/facebook/buck/rules:build_rule",
        "//src/com/facebook/buck/rules:caching_build_engine_delegates",
        "//src/com/facebook/buck/rules:interfaces",
        "//src/com/facebook/buck/rules:relative_cell_name",
        "//src/com/facebook/buck/rules:rule_key",
        "//src/com/facebook/buck/rules:rules",
        "//src/com/facebook/buck/rules/args:args",
        "//src/com/facebook/buck/rules/coercer:coercer",
        "//src/com/facebook/buck/rules/coercer:types",
        "//src/com/facebook/buck/rules/keys:keys",
        "//src/com/facebook/buck/rules/macros:macros",
        "//src/com/facebook/buck/rules/macros:types",
        "//src/com/facebook/buck/rules/query:types",
        "//src/com/facebook/buck/shell:rules",
        "//src/com/facebook/buck/shell:steps",
        "//src/com/facebook/buck/shell:worker",
        "//src/com/facebook/buck/shell:worker_job_params",
        "//src/com/facebook/buck/shell:worker_pool_factory",
        "//src/com/facebook/buck/shell:worker_process",
        "//src/com/facebook/buck/shell:worker_tool",
        "//src/com/facebook/buck/slb:slb",
        "//src/com/facebook/buck/step:step",
        "//src/com/facebook/buck/step/fs:fs",
        "//src/com/facebook/buck/test:test",
        "//src/com/facebook/buck/test/result/type:type",
        "//src/com/facebook/buck/test/selectors:selectors",
        "//src/com/facebook/buck/timing:timing",
        "//src/com/facebook/buck/util:exceptions",
        "//src/com/facebook/buck/util:io",
        "//src/com/facebook/buck/util:process_executor",
        "//src/com/facebook/buck/util:util",
        "//src/com/facebook/buck/util/autosparse:autosparse_config",
        "//src/com/facebook/buck/util/cache:cache",
        "//src/com/facebook/buck/util/concurrent:concurrent",
        "//src/com/facebook/buck/util/environment:platform",
        "//src/com/facebook/buck/util/immutables:immutables",
        "//src/com/facebook/buck/util/sha1:sha1",
        "//src/com/facebook/buck/util/versioncontrol:versioncontrol",
        "//src/com/facebook/buck/util/versioncontrol:versioncontrol_hg",
        "//src/com/facebook/buck/versions:translator",
        "//src/com/facebook/buck/versions:types",
        "//src/com/facebook/buck/zip:constants",
        "//src/com/facebook/buck/zip:stream",
        "//third-party/java/asm:asm",
        "//third-party/java/dd-plist:dd-plist",
        "//third-party/java/gson:gson",
        "//third-party/java/guava:guava",
        "//third-party/java/immutables:immutables",
        "//third-party/java/infer-annotations:infer-annotations",
        "//third-party/java/jackson:jackson-annotations",
        "//third-party/java/jackson:jackson-core",
        "//third-party/java/jackson:jackson-databind",
        "//third-party/java/jna:jna",
        "//third-party/java/jsr:jsr305",
        "//third-party/java/okhttp:okhttp",
        "//third-party/java/stringtemplate:stringtemplate",
        "//third-party/java/thrift:libthrift",
    ],
)

# This is here only so that we don't have to let rules depend on xcode.
# FrameworkPathArg depends on xcode because Javac insists on being able to see the type on which
# we're calling .toString()
FRAMEWORK_PATH_ARG_SRCS = [
    "FrameworkPathArg.java",
]

java_library(
    name = "framework_path_arg",
    srcs = FRAMEWORK_PATH_ARG_SRCS,
    tests = [
        "//test/com/facebook/buck/cxx:cxx",
    ],
    visibility = [
        "//test/com/facebook/buck/cxx/...",
    ],
    deps = [
        "//src/com/facebook/buck/android:utils",
        "//src/com/facebook/buck/apple/xcode:xcode",
        "//src/com/facebook/buck/config:config",
        "//src/com/facebook/buck/event:event",
        "//src/com/facebook/buck/event:interfaces",
        "//src/com/facebook/buck/event/external:external_lib",
        "//src/com/facebook/buck/graph:graph",
        "//src/com/facebook/buck/io:BuckPaths",
        "//src/com/facebook/buck/io:ProjectFilesystemDelegate",
        "//src/com/facebook/buck/io:executable-finder",
        "//src/com/facebook/buck/io:io",
        "//src/com/facebook/buck/io:transport",
        "//src/com/facebook/buck/jvm/core:classhash",
        "//src/com/facebook/buck/jvm/core:packagefinder",
        "//src/com/facebook/buck/jvm/java:javac-sink",
        "//src/com/facebook/buck/jvm/java/abi/source/api:api",
        "//src/com/facebook/buck/message_ipc:message_ipc",
        "//src/com/facebook/buck/model:build_id",
        "//src/com/facebook/buck/model:macros",
        "//src/com/facebook/buck/model:model",
        "//src/com/facebook/buck/model:simple_types",
        "//src/com/facebook/buck/parser:rule_pattern",
        "//src/com/facebook/buck/python:support",
        "//src/com/facebook/buck/query:query",
        "//src/com/facebook/buck/rules:build_rule",
        "//src/com/facebook/buck/rules:interfaces",
        "//src/com/facebook/buck/rules:relative_cell_name",
        "//src/com/facebook/buck/rules:rule_key",
        "//src/com/facebook/buck/rules/args:args",
        "//src/com/facebook/buck/rules/coercer:coercer",
        "//src/com/facebook/buck/rules/coercer:types",
        "//src/com/facebook/buck/rules/macros:macros",
        "//src/com/facebook/buck/rules/macros:types",
        "//src/com/facebook/buck/rules/query:types",
        "//src/com/facebook/buck/shell:worker_process",
        "//src/com/facebook/buck/step:step",
        "//src/com/facebook/buck/test/result/type:type",
        "//src/com/facebook/buck/timing:timing",
        "//src/com/facebook/buck/util:exceptions",
        "//src/com/facebook/buck/util:io",
        "//src/com/facebook/buck/util:process_executor",
        "//src/com/facebook/buck/util:util",
        "//src/com/facebook/buck/util/autosparse:autosparse_config",
        "//src/com/facebook/buck/util/concurrent:concurrent",
        "//src/com/facebook/buck/util/environment:platform",
        "//src/com/facebook/buck/util/immutables:immutables",
        "//src/com/facebook/buck/util/sha1:sha1",
        "//src/com/facebook/buck/util/versioncontrol:versioncontrol",
        "//src/com/facebook/buck/util/versioncontrol:versioncontrol_hg",
        "//src/com/facebook/buck/versions:translator",
        "//src/com/facebook/buck/versions:types",
        "//src/com/facebook/buck/zip:stream",
        "//third-party/java/asm:asm",
        "//third-party/java/dd-plist:dd-plist",
        "//third-party/java/gson:gson",
        "//third-party/java/guava:guava",
        "//third-party/java/immutables:immutables",
        "//third-party/java/infer-annotations:infer-annotations",
        "//third-party/java/jackson:jackson-annotations",
        "//third-party/java/jackson:jackson-core",
        "//third-party/java/jackson:jackson-databind",
        "//third-party/java/jna:jna",
        "//third-party/java/jsr:jsr305",
    ],
)

java_immutables_library(
    name = "rules",
    srcs = glob(
        ["*.java"],
        excludes = PLATFORM_SRCS + FRAMEWORK_PATH_ARG_SRCS,
    ),
    immutable_types = [
        "CxxCompilationDatabaseDependencies",
        "CxxCompilationDatabaseEntry",
        "CxxHeaders",
        "CxxHeaderSourceSpec",
        "CxxSource",
        "CxxSourceRuleFactory",
        "CxxSourceSet",
        "MachoHeader",
        "OmnibusRoots",
        "PreprocessorFlags",
    ],
    resources = [
        "modulemap.st",
    ],
    tests = [
        "//test/com/facebook/buck/cxx:cxx",
    ],
    visibility = [
        "PUBLIC",
    ],
    deps = [
        "//src/com/facebook/buck/android:apkmodule",
        "//src/com/facebook/buck/android:packageable",
        "//src/com/facebook/buck/android:utils",
        "//src/com/facebook/buck/apple/clang:headermap",
        "//src/com/facebook/buck/apple/xcode:xcode",
        "//src/com/facebook/buck/artifact_cache:artifact_cache",
        "//src/com/facebook/buck/cli:config",
        "//src/com/facebook/buck/config:config",
        "//src/com/facebook/buck/cxx:framework_path_arg",
        "//src/com/facebook/buck/cxx:platform",
        "//src/com/facebook/buck/cxx/elf:elf",
        "//src/com/facebook/buck/event:event",
        "//src/com/facebook/buck/event:interfaces",
        "//src/com/facebook/buck/event/external:external_lib",
        "//src/com/facebook/buck/graph:graph",
        "//src/com/facebook/buck/hashing:hashing",
        "//src/com/facebook/buck/io:BuckPaths",
        "//src/com/facebook/buck/io:MorePaths.java",
        "//src/com/facebook/buck/io:ProjectFilesystemDelegate",
        "//src/com/facebook/buck/io:executable-finder",
        "//src/com/facebook/buck/io:io",
        "//src/com/facebook/buck/io:transport",
        "//src/com/facebook/buck/json:rules",
        "//src/com/facebook/buck/json:steps",
        "//src/com/facebook/buck/jvm/core:classhash",
        "//src/com/facebook/buck/jvm/core:packagefinder",
        "//src/com/facebook/buck/jvm/java:javac-sink",
        "//src/com/facebook/buck/jvm/java:support",
        "//src/com/facebook/buck/jvm/java/abi/source/api:api",
        "//src/com/facebook/buck/jvm/java/classes:classes",
        "//src/com/facebook/buck/log:api",
        "//src/com/facebook/buck/message_ipc:message_ipc",
        "//src/com/facebook/buck/model:build_id",
        "//src/com/facebook/buck/model:macros",
        "//src/com/facebook/buck/model:model",
        "//src/com/facebook/buck/model:simple_types",
        "//src/com/facebook/buck/parser:rule_pattern",
        "//src/com/facebook/buck/python:support",
        "//src/com/facebook/buck/query:query",
        "//src/com/facebook/buck/rules:build_rule",
        "//src/com/facebook/buck/rules:caching_build_engine_delegates",
        "//src/com/facebook/buck/rules:command_tool",
        "//src/com/facebook/buck/rules:interfaces",
        "//src/com/facebook/buck/rules:relative_cell_name",
        "//src/com/facebook/buck/rules:rule_key",
        "//src/com/facebook/buck/rules:rules",
        "//src/com/facebook/buck/rules/args:args",
        "//src/com/facebook/buck/rules/coercer:coercer",
        "//src/com/facebook/buck/rules/coercer:types",
        "//src/com/facebook/buck/rules/keys:keys",
        "//src/com/facebook/buck/rules/macros:macros",
        "//src/com/facebook/buck/rules/macros:types",
        "//src/com/facebook/buck/rules/query:query",
        "//src/com/facebook/buck/rules/query:types",
        "//src/com/facebook/buck/shell:rules",
        "//src/com/facebook/buck/shell:steps",
        "//src/com/facebook/buck/shell:worker",
        "//src/com/facebook/buck/shell:worker_job_params",
        "//src/com/facebook/buck/shell:worker_pool_factory",
        "//src/com/facebook/buck/shell:worker_process",
        "//src/com/facebook/buck/shell:worker_tool",
        "//src/com/facebook/buck/slb:slb",
        "//src/com/facebook/buck/step:step",
        "//src/com/facebook/buck/step/fs:fs",
        "//src/com/facebook/buck/test:test",
        "//src/com/facebook/buck/test/result/type:type",
        "//src/com/facebook/buck/test/selectors:selectors",
        "//src/com/facebook/buck/timing:timing",
        "//src/com/facebook/buck/util:exceptions",
        "//src/com/facebook/buck/util:io",
        "//src/com/facebook/buck/util:object_mapper",
        "//src/com/facebook/buck/util:process_executor",
        "//src/com/facebook/buck/util:util",
        "//src/com/facebook/buck/util/autosparse:autosparse_config",
        "//src/com/facebook/buck/util/cache:cache",
        "//src/com/facebook/buck/util/concurrent:concurrent",
        "//src/com/facebook/buck/util/environment:platform",
        "//src/com/facebook/buck/util/immutables:immutables",
        "//src/com/facebook/buck/util/sha1:sha1",
        "//src/com/facebook/buck/util/versioncontrol:versioncontrol",
        "//src/com/facebook/buck/util/versioncontrol:versioncontrol_hg",
        "//src/com/facebook/buck/versions:translator",
        "//src/com/facebook/buck/versions:types",
        "//src/com/facebook/buck/versions:versions",
        "//src/com/facebook/buck/zip:constants",
        "//src/com/facebook/buck/zip:stream",
        "//third-party/java/asm:asm",
        "//third-party/java/dd-plist:dd-plist",
        "//third-party/java/gson:gson",
        "//third-party/java/guava:guava",
        "//third-party/java/immutables:immutables",
        "//third-party/java/infer-annotations:infer-annotations",
        "//third-party/java/jackson:jackson-annotations",
        "//third-party/java/jackson:jackson-core",
        "//third-party/java/jackson:jackson-databind",
        "//third-party/java/jna:jna",
        "//third-party/java/jsr:jsr305",
        "//third-party/java/okhttp:okhttp",
        "//third-party/java/stringtemplate:stringtemplate",
        "//third-party/java/thrift:libthrift",
    ],
)
