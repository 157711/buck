APPLE_TEST_INTEGRATION_TEST_SRCS = [
    "AppleTestIntegrationTest.java",
    "AppleBundleIntegrationTest.java",
]

java_library(
    name = "testutil",
    srcs = glob(
        ["*.java"],
        excludes = ["*Test.java"],
    ),
    visibility = [
        "//test/...",
    ],
    deps = [
        "//src/com/facebook/buck/apple:platform",
        "//src/com/facebook/buck/apple:rules",
        "//src/com/facebook/buck/apple/xcode:xcode",
        "//src/com/facebook/buck/cli:config",
        "//src/com/facebook/buck/cxx:platform",
        "//src/com/facebook/buck/cxx:rules",
        "//src/com/facebook/buck/io:executable-finder",
        "//src/com/facebook/buck/io:io",
        "//src/com/facebook/buck/model:model",
        "//src/com/facebook/buck/model:simple_types",
        "//src/com/facebook/buck/rules:build_rule",
        "//src/com/facebook/buck/rules/coercer:coercer",
        "//src/com/facebook/buck/rules/macros:types",
        "//src/com/facebook/buck/swift:platform",
        "//src/com/facebook/buck/swift:swift",
        "//src/com/facebook/buck/util:process_executor",
        "//src/com/facebook/buck/util/environment:platform",
        "//test/com/facebook/buck/cli:FakeBuckConfig",
        "//test/com/facebook/buck/cxx:testutil",
        "//test/com/facebook/buck/rules:testutil",
        "//test/com/facebook/buck/testutil:testutil",
        "//test/com/facebook/buck/testutil/integration:util",
        "//test/com/facebook/buck/util:testutil",
        "//third-party/java/guava:guava",
        "//third-party/java/hamcrest:java-hamcrest",
        "//third-party/java/jsr:jsr305",
        "//third-party/java/junit:junit",
        "//third-party/java/plexus:plexus-utils",
    ],
)
# These are separate from the rest of the tests so we can run
# them separately, avoiding the 20 second timeout in the iOS simulator.

# fbxctest resources are too long (over 256 chars) for Windows to handle.
if os_platform == "darwin":
    java_test(
        name = "apple_test_integration",
        run_test_separately = True,
        srcs = APPLE_TEST_INTEGRATION_TEST_SRCS,
        deps = [
            "//src/com/facebook/buck/apple:platform",
            "//src/com/facebook/buck/apple:rules",
            "//src/com/facebook/buck/cxx:rules",
            "//src/com/facebook/buck/io:io",
            "//src/com/facebook/buck/model:model",
            "//src/com/facebook/buck/util/environment:platform",
            "//src/com/facebook/buck/util:constants",
            "//src/com/facebook/buck/util:exceptions",
            "//src/com/facebook/buck/util:process_executor",
            "//test/com/facebook/buck/apple:testutil",
            "//test/com/facebook/buck/model:testutil",
            "//test/com/facebook/buck/testutil/integration:util",
            "//test/com/facebook/buck/testutil:testutil",
            "//third-party/java/dd-plist:dd-plist",
            "//third-party/java/guava:guava",
            "//third-party/java/hamcrest:java-hamcrest",
            "//third-party/java/junit:junit",
        ],
        resources = glob(["testdata/**"]),
        labels = ["glacial"],
    )

    java_test(
        name = "apple",
        srcs = glob(["*Test.java"], excludes=APPLE_TEST_INTEGRATION_TEST_SRCS),
        resources = glob(["testdata/**"]),
        labels = ["long_running"],
        deps = [
            "//src/com/facebook/buck/apple:platform",
            "//src/com/facebook/buck/apple:rules",
            "//src/com/facebook/buck/cli:config",
            "//src/com/facebook/buck/cxx:platform",
            "//src/com/facebook/buck/cxx:rules",
            "//src/com/facebook/buck/io:executable-finder",
            "//src/com/facebook/buck/io:io",
            "//src/com/facebook/buck/model:model",
            "//src/com/facebook/buck/model:simple_types",
            "//src/com/facebook/buck/parser:rule_pattern",
            "//src/com/facebook/buck/rules:build_rule",
            "//src/com/facebook/buck/rules:rule_key",
            "//src/com/facebook/buck/rules:rules",
            "//src/com/facebook/buck/rules:types",
            "//src/com/facebook/buck/rules/args:args",
            "//src/com/facebook/buck/rules/coercer:coercer",
            "//src/com/facebook/buck/rules/keys:keys",
            "//src/com/facebook/buck/rules/macros:types",
            "//src/com/facebook/buck/shell:rules",
            "//src/com/facebook/buck/shell:steps",
            "//src/com/facebook/buck/step:step",
            "//src/com/facebook/buck/swift:platform",
            "//src/com/facebook/buck/test:test",
            "//src/com/facebook/buck/test/result/type:type",
            "//src/com/facebook/buck/test/selectors:selectors",
            "//src/com/facebook/buck/util:exceptions",
            "//src/com/facebook/buck/util:process_executor",
            "//src/com/facebook/buck/util:util",
            "//src/com/facebook/buck/util/environment:platform",
            "//src/com/facebook/buck/zip:unzip",
            "//test/com/facebook/buck/apple:testutil",
            "//test/com/facebook/buck/apple/project_generator:testutil",
            "//test/com/facebook/buck/cli:FakeBuckConfig",
            "//test/com/facebook/buck/cxx:testutil",
            "//test/com/facebook/buck/io:testutil",
            "//test/com/facebook/buck/model:testutil",
            "//test/com/facebook/buck/rules:testutil",
            "//test/com/facebook/buck/rules/macros:testutil",
            "//test/com/facebook/buck/shell:testutil",
            "//test/com/facebook/buck/step:testutil",
            "//test/com/facebook/buck/testutil:testutil",
            "//test/com/facebook/buck/testutil/integration:util",
            "//test/com/facebook/buck/util:testutil",
            "//third-party/java/dd-plist:dd-plist",
            "//third-party/java/easymock:easymock",
            "//third-party/java/guava:guava",
            "//third-party/java/hamcrest:hamcrest-junit",
            "//third-party/java/hamcrest:java-hamcrest",
            "//third-party/java/junit:junit",
        ],
    )
